/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,uselessCode} checked by tsc
 */
import * as tslib_1 from "tslib";
import { includes, isUndefined, isNull, isArray, isObject, isBoolean, defaults, each, extend, find, has, initial, last, clone, reduce, keys, isEmpty, forEach, } from 'lodash';
/**
 * @param {?} object
 * @param {?} configuration
 * @return {?}
 */
export function RestangularConfigurer(object, configuration) {
    object.configuration = configuration;
    /**
     * Those are HTTP safe methods for which there is no need to pass any data with the request.
     * @type {?}
     */
    var safeMethods = ['get', 'head', 'options', 'trace', 'getlist'];
    configuration.isSafe = function (operation) {
        return includes(safeMethods, operation.toLowerCase());
    };
    /** @type {?} */
    var absolutePattern = /^https?:\/\//i;
    configuration.isAbsoluteUrl = function (string) {
        return isUndefined(configuration.absoluteUrl) || isNull(configuration.absoluteUrl) ?
            string && absolutePattern.test(string) :
            configuration.absoluteUrl;
    };
    configuration.absoluteUrl = isUndefined(configuration.absoluteUrl) ? true : configuration.absoluteUrl;
    object.setSelfLinkAbsoluteUrl = function (value) {
        configuration.absoluteUrl = value;
    };
    /**
     * This is the BaseURL to be used with Restangular
     */
    configuration.baseUrl = isUndefined(configuration.baseUrl) ? '' : configuration.baseUrl;
    object.setBaseUrl = function (newBaseUrl) {
        configuration.baseUrl = /\/$/.test(newBaseUrl) ?
            newBaseUrl.substring(0, newBaseUrl.length - 1) :
            newBaseUrl;
        return this;
    };
    /**
     * Sets the extra fields to keep from the parents
     */
    configuration.extraFields = configuration.extraFields || [];
    object.setExtraFields = function (newExtraFields) {
        configuration.extraFields = newExtraFields;
        return this;
    };
    /**
     * Some default $http parameter to be used in EVERY call
     **/
    configuration.defaultHttpFields = configuration.defaultHttpFields || {};
    object.setDefaultHttpFields = function (values) {
        configuration.defaultHttpFields = values;
        return this;
    };
    /**
     * Always return plain data, no restangularized object
     **/
    configuration.plainByDefault = configuration.plainByDefault || false;
    object.setPlainByDefault = function (value) {
        configuration.plainByDefault = value === true ? true : false;
        return this;
    };
    configuration.withHttpValues = function (httpLocalConfig, obj) {
        return defaults(obj, httpLocalConfig, configuration.defaultHttpFields);
    };
    configuration.encodeIds = isUndefined(configuration.encodeIds) ? true : configuration.encodeIds;
    object.setEncodeIds = function (encode) {
        configuration.encodeIds = encode;
    };
    configuration.defaultRequestParams = configuration.defaultRequestParams || {
        get: {},
        post: {},
        put: {},
        remove: {},
        common: {}
    };
    object.setDefaultRequestParams = function (param1, param2) {
        /** @type {?} */
        var methods = [];
        /** @type {?} */
        var params = param2 || param1;
        if (!isUndefined(param2)) {
            if (isArray(param1)) {
                methods = param1;
            }
            else {
                methods.push(param1);
            }
        }
        else {
            methods.push('common');
        }
        each(methods, function (method) {
            configuration.defaultRequestParams[method] = params;
        });
        return this;
    };
    object.requestParams = configuration.defaultRequestParams;
    configuration.defaultHeaders = configuration.defaultHeaders || {};
    object.setDefaultHeaders = function (headers) {
        configuration.defaultHeaders = headers;
        object.defaultHeaders = configuration.defaultHeaders;
        return this;
    };
    object.defaultHeaders = configuration.defaultHeaders;
    /**
     * Method overriders response Method
     **/
    configuration.defaultResponseMethod = configuration.defaultResponseMethod || 'promise';
    object.setDefaultResponseMethod = function (method) {
        configuration.defaultResponseMethod = method;
        object.defaultResponseMethod = configuration.defaultResponseMethod;
        return this;
    };
    object.defaultResponseMethod = configuration.defaultResponseMethod;
    /**
     * Method overriders will set which methods are sent via POST with an X-HTTP-Method-Override
     **/
    configuration.methodOverriders = configuration.methodOverriders || [];
    object.setMethodOverriders = function (values) {
        /** @type {?} */
        var overriders = extend([], values);
        if (configuration.isOverridenMethod('delete', overriders)) {
            overriders.push('remove');
        }
        configuration.methodOverriders = overriders;
        return this;
    };
    configuration.jsonp = isUndefined(configuration.jsonp) ? false : configuration.jsonp;
    object.setJsonp = function (active) {
        configuration.jsonp = active;
    };
    configuration.isOverridenMethod = function (method, values) {
        /** @type {?} */
        var search = values || configuration.methodOverriders;
        return !isUndefined(find(search, function (one) {
            return one.toLowerCase() === method.toLowerCase();
        }));
    };
    /**
     * Sets the URL creator type. For now, only Path is created. In the future we'll have queryParams
     **/
    configuration.urlCreator = configuration.urlCreator || 'path';
    object.setUrlCreator = function (name) {
        if (!has(configuration.urlCreatorFactory, name)) {
            throw new Error('URL Path selected isn\'t valid');
        }
        configuration.urlCreator = name;
        return this;
    };
    /**
     * You can set the restangular fields here. The 3 required fields for Restangular are:
     *
     * id: Id of the element
     * route: name of the route of this element
     * parentResource: the reference to the parent resource
     *
     *  All of this fields except for id, are handled (and created) by Restangular. By default,
     *  the field values will be id, route and parentResource respectively
     */
    configuration.restangularFields = configuration.restangularFields || {
        id: 'id',
        route: 'route',
        parentResource: 'parentResource',
        restangularCollection: 'restangularCollection',
        cannonicalId: '__cannonicalId',
        etag: 'restangularEtag',
        selfLink: 'href',
        get: 'get',
        getList: 'getList',
        put: 'put',
        post: 'post',
        remove: 'remove',
        head: 'head',
        trace: 'trace',
        options: 'options',
        patch: 'patch',
        getRestangularUrl: 'getRestangularUrl',
        getRequestedUrl: 'getRequestedUrl',
        putElement: 'putElement',
        addRestangularMethod: 'addRestangularMethod',
        getParentList: 'getParentList',
        clone: 'clone',
        ids: 'ids',
        httpConfig: '_$httpConfig',
        reqParams: 'reqParams',
        one: 'one',
        all: 'all',
        several: 'several',
        oneUrl: 'oneUrl',
        allUrl: 'allUrl',
        customPUT: 'customPUT',
        customPATCH: 'customPATCH',
        customPOST: 'customPOST',
        customDELETE: 'customDELETE',
        customGET: 'customGET',
        customGETLIST: 'customGETLIST',
        customOperation: 'customOperation',
        doPUT: 'doPUT',
        doPATCH: 'doPATCH',
        doPOST: 'doPOST',
        doDELETE: 'doDELETE',
        doGET: 'doGET',
        doGETLIST: 'doGETLIST',
        fromServer: 'fromServer',
        withConfig: 'withConfig',
        withHttpConfig: 'withHttpConfig',
        singleOne: 'singleOne',
        plain: 'plain',
        save: 'save',
        restangularized: 'restangularized'
    };
    object.setRestangularFields = function (resFields) {
        configuration.restangularFields =
            extend({}, configuration.restangularFields, resFields);
        return this;
    };
    configuration.isRestangularized = function (obj) {
        return !!obj[configuration.restangularFields.restangularized];
    };
    configuration.setFieldToElem = function (field, elem, value) {
        /** @type {?} */
        var properties = field.split('.');
        /** @type {?} */
        var idValue = elem;
        each(initial(properties), function (prop) {
            idValue[prop] = {};
            idValue = idValue[prop];
        });
        /** @type {?} */
        var index = last(properties);
        idValue[index] = value;
        return this;
    };
    configuration.getFieldFromElem = function (field, elem) {
        /** @type {?} */
        var properties = field.split('.');
        /** @type {?} */
        var idValue = elem;
        each(properties, function (prop) {
            if (idValue) {
                idValue = idValue[prop];
            }
        });
        return clone(idValue);
    };
    configuration.setIdToElem = function (elem, id /*, route */) {
        configuration.setFieldToElem(configuration.restangularFields.id, elem, id);
        return this;
    };
    configuration.getIdFromElem = function (elem) {
        return configuration.getFieldFromElem(configuration.restangularFields.id, elem);
    };
    configuration.isValidId = function (elemId) {
        return '' !== elemId && !isUndefined(elemId) && !isNull(elemId);
    };
    configuration.setUrlToElem = function (elem, url /*, route */) {
        configuration.setFieldToElem(configuration.restangularFields.selfLink, elem, url);
        return this;
    };
    configuration.getUrlFromElem = function (elem) {
        return configuration.getFieldFromElem(configuration.restangularFields.selfLink, elem);
    };
    configuration.useCannonicalId = isUndefined(configuration.useCannonicalId) ? false : configuration.useCannonicalId;
    object.setUseCannonicalId = function (value) {
        configuration.useCannonicalId = value;
        return this;
    };
    configuration.getCannonicalIdFromElem = function (elem) {
        /** @type {?} */
        var cannonicalId = elem[configuration.restangularFields.cannonicalId];
        /** @type {?} */
        var actualId = configuration.isValidId(cannonicalId) ? cannonicalId : configuration.getIdFromElem(elem);
        return actualId;
    };
    /**
     * Sets the Response parser. This is used in case your response isn't directly the data.
     * For example if you have a response like {meta: {'meta'}, data: {name: 'Gonto'}}
     * you can extract this data which is the one that needs wrapping
     *
     * The ResponseExtractor is a function that receives the response and the method executed.
     */
    configuration.responseInterceptors = configuration.responseInterceptors ? tslib_1.__spread(configuration.responseInterceptors) : [];
    configuration.defaultResponseInterceptor = function (data /*, operation, what, url, response, subject */) {
        return data || {};
    };
    configuration.responseExtractor = function (data, operation, what, url, response, subject) {
        /** @type {?} */
        var interceptors = clone(configuration.responseInterceptors);
        interceptors.push(configuration.defaultResponseInterceptor);
        /** @type {?} */
        var theData = data;
        each(interceptors, function (interceptor) {
            theData = interceptor(theData, operation, what, url, response, subject);
        });
        return theData;
    };
    object.addResponseInterceptor = function (extractor) {
        configuration.responseInterceptors.push(extractor);
        return this;
    };
    configuration.errorInterceptors = configuration.errorInterceptors ? tslib_1.__spread(configuration.errorInterceptors) : [];
    object.addErrorInterceptor = function (interceptor) {
        configuration.errorInterceptors = tslib_1.__spread([interceptor], configuration.errorInterceptors);
        return this;
    };
    object.setResponseInterceptor = object.addResponseInterceptor;
    object.setResponseExtractor = object.addResponseInterceptor;
    object.setErrorInterceptor = object.addErrorInterceptor;
    /**
     * Response interceptor is called just before resolving promises.
     */
    /**
     * Request interceptor is called before sending an object to the server.
     */
    configuration.requestInterceptors = configuration.requestInterceptors ? tslib_1.__spread(configuration.requestInterceptors) : [];
    configuration.defaultInterceptor = function (element, operation, path, url, headers, params, httpConfig) {
        return {
            element: element,
            headers: headers,
            params: params,
            httpConfig: httpConfig
        };
    };
    configuration.fullRequestInterceptor = function (element, operation, path, url, headers, params, httpConfig) {
        /** @type {?} */
        var interceptors = clone(configuration.requestInterceptors);
        /** @type {?} */
        var defaultRequest = configuration.defaultInterceptor(element, operation, path, url, headers, params, httpConfig);
        return reduce(interceptors, function (request, interceptor) {
            /** @type {?} */
            var returnInterceptor = interceptor(request.element, operation, path, url, request.headers, request.params, request.httpConfig);
            return extend(request, returnInterceptor);
        }, defaultRequest);
    };
    object.addRequestInterceptor = function (interceptor) {
        configuration.requestInterceptors.push(function (elem, operation, path, url, headers, params, httpConfig) {
            return {
                headers: headers,
                params: params,
                element: interceptor(elem, operation, path, url),
                httpConfig: httpConfig
            };
        });
        return this;
    };
    object.setRequestInterceptor = object.addRequestInterceptor;
    object.addFullRequestInterceptor = function (interceptor) {
        configuration.requestInterceptors.push(interceptor);
        return this;
    };
    object.setFullRequestInterceptor = object.addFullRequestInterceptor;
    configuration.onBeforeElemRestangularized = configuration.onBeforeElemRestangularized || function (elem) {
        return elem;
    };
    object.setOnBeforeElemRestangularized = function (post) {
        configuration.onBeforeElemRestangularized = post;
        return this;
    };
    object.setRestangularizePromiseInterceptor = function (interceptor) {
        configuration.restangularizePromiseInterceptor = interceptor;
        return this;
    };
    /**
     * This method is called after an element has been "Restangularized".
     *
     * It receives the element, a boolean indicating if it's an element or a collection
     * and the name of the model
     *
     */
    configuration.onElemRestangularized = configuration.onElemRestangularized || function (elem) {
        return elem;
    };
    object.setOnElemRestangularized = function (post) {
        configuration.onElemRestangularized = post;
        return this;
    };
    configuration.shouldSaveParent = configuration.shouldSaveParent || function () {
        return true;
    };
    object.setParentless = function (values) {
        if (isArray(values)) {
            configuration.shouldSaveParent = function (route) {
                return !includes(values, route);
            };
        }
        else if (isBoolean(values)) {
            configuration.shouldSaveParent = function () {
                return !values;
            };
        }
        return this;
    };
    /**
     * This lets you set a suffix to every request.
     *
     * For example, if your api requires that for JSon requests you do /users/123.json, you can set that
     * in here.
     *
     *
     * By default, the suffix is null
     */
    configuration.suffix = isUndefined(configuration.suffix) ? null : configuration.suffix;
    object.setRequestSuffix = function (newSuffix) {
        configuration.suffix = newSuffix;
        return this;
    };
    /**
     * Add element transformers for certain routes.
     */
    configuration.transformers = configuration.transformers || {};
    object.addElementTransformer = function (type, secondArg, thirdArg) {
        /** @type {?} */
        var isCollection = null;
        /** @type {?} */
        var transformer = null;
        if (arguments.length === 2) {
            transformer = secondArg;
        }
        else {
            transformer = thirdArg;
            isCollection = secondArg;
        }
        /** @type {?} */
        var typeTransformers = configuration.transformers[type];
        if (!typeTransformers) {
            typeTransformers = configuration.transformers[type] = [];
        }
        typeTransformers.push(function (coll, elem) {
            if (isNull(isCollection) || (coll === isCollection)) {
                return transformer(elem);
            }
            return elem;
        });
        return object;
    };
    object.extendCollection = function (route, fn) {
        return object.addElementTransformer(route, true, fn);
    };
    object.extendModel = function (route, fn) {
        return object.addElementTransformer(route, false, fn);
    };
    configuration.transformElem = function (elem, isCollection, route, Restangular, force) {
        if (!force && !configuration.transformLocalElements && !elem[configuration.restangularFields.fromServer]) {
            return elem;
        }
        /** @type {?} */
        var typeTransformers = configuration.transformers[route];
        /** @type {?} */
        var changedElem = elem;
        if (typeTransformers) {
            each(typeTransformers, function (transformer) {
                changedElem = transformer(isCollection, changedElem);
            });
        }
        return configuration.onElemRestangularized(changedElem, isCollection, route, Restangular);
    };
    configuration.transformLocalElements = isUndefined(configuration.transformLocalElements) ?
        false :
        configuration.transformLocalElements;
    object.setTransformOnlyServerElements = function (active) {
        configuration.transformLocalElements = !active;
    };
    configuration.fullResponse = isUndefined(configuration.fullResponse) ? false : configuration.fullResponse;
    object.setFullResponse = function (full) {
        configuration.fullResponse = full;
        return this;
    };
    // Internal values and functions
    configuration.urlCreatorFactory = {};
    /**
     * Base URL Creator. Base prototype for everything related to it
     *
     * @type {?}
     */
    var BaseCreator = function () {
    };
    BaseCreator.prototype.setConfig = function (config) {
        this.config = config;
        return this;
    };
    BaseCreator.prototype.parentsArray = function (current) {
        /** @type {?} */
        var parents = [];
        while (current) {
            parents.push(current);
            current = current[this.config.restangularFields.parentResource];
        }
        return parents.reverse();
    };
    /**
     * @param {?} config
     * @param {?} $http
     * @param {?} url
     * @param {?} configurer
     * @return {?}
     */
    function RestangularResource(config, $http, url, configurer) {
        /** @type {?} */
        var resource = {};
        each(keys(configurer), function (key) {
            /** @type {?} */
            var value = configurer[key];
            // Add default parameters
            value.params = extend({}, value.params, config.defaultRequestParams[value.method.toLowerCase()]);
            // We don't want the ? if no params are there
            if (isEmpty(value.params)) {
                delete value.params;
            }
            if (config.isSafe(value.method)) {
                resource[key] = function () {
                    /** @type {?} */
                    var resultConfig = extend(value, {
                        url: url
                    });
                    return $http.createRequest(resultConfig);
                };
            }
            else {
                resource[key] = function (data) {
                    /** @type {?} */
                    var resultConfig = extend(value, {
                        url: url,
                        data: data
                    });
                    return $http.createRequest(resultConfig);
                };
            }
        });
        return resource;
    }
    BaseCreator.prototype.resource = function (current, $http, localHttpConfig, callHeaders, callParams, what, etag, operation) {
        /** @type {?} */
        var params = defaults(callParams || {}, this.config.defaultRequestParams.common);
        /** @type {?} */
        var headers = defaults(callHeaders || {}, this.config.defaultHeaders);
        if (etag) {
            if (!configuration.isSafe(operation)) {
                headers['If-Match'] = etag;
            }
            else {
                headers['If-None-Match'] = etag;
            }
        }
        /** @type {?} */
        var url = this.base(current);
        if (what) {
            /** @type {?} */
            var add = '';
            if (!/\/$/.test(url)) {
                add += '/';
            }
            add += what;
            url += add;
        }
        if (this.config.suffix &&
            url.indexOf(this.config.suffix, url.length - this.config.suffix.length) === -1 && !this.config.getUrlFromElem(current)) {
            url += this.config.suffix;
        }
        current[this.config.restangularFields.httpConfig] = undefined;
        return RestangularResource(this.config, $http, url, {
            getList: this.config.withHttpValues(localHttpConfig, {
                method: 'GET',
                params: params,
                headers: headers
            }),
            get: this.config.withHttpValues(localHttpConfig, {
                method: 'GET',
                params: params,
                headers: headers
            }),
            jsonp: this.config.withHttpValues(localHttpConfig, {
                method: 'jsonp',
                params: params,
                headers: headers
            }),
            put: this.config.withHttpValues(localHttpConfig, {
                method: 'PUT',
                params: params,
                headers: headers
            }),
            post: this.config.withHttpValues(localHttpConfig, {
                method: 'POST',
                params: params,
                headers: headers
            }),
            remove: this.config.withHttpValues(localHttpConfig, {
                method: 'DELETE',
                params: params,
                headers: headers
            }),
            head: this.config.withHttpValues(localHttpConfig, {
                method: 'HEAD',
                params: params,
                headers: headers
            }),
            trace: this.config.withHttpValues(localHttpConfig, {
                method: 'TRACE',
                params: params,
                headers: headers
            }),
            options: this.config.withHttpValues(localHttpConfig, {
                method: 'OPTIONS',
                params: params,
                headers: headers
            }),
            patch: this.config.withHttpValues(localHttpConfig, {
                method: 'PATCH',
                params: params,
                headers: headers
            })
        });
    };
    /**
     * This is the Path URL creator. It uses Path to show Hierarchy in the Rest API.
     * This means that if you have an Account that then has a set of Buildings, a URL to a building
     * would be /accounts/123/buildings/456
     *
     * @type {?}
     */
    var Path = function () {
    };
    Path.prototype = new BaseCreator();
    Path.prototype.normalizeUrl = function (url) {
        /** @type {?} */
        var parts = /((?:http[s]?:)?\/\/)?(.*)?/.exec(url);
        parts[2] = parts[2].replace(/[\\\/]+/g, '/');
        return (typeof parts[1] !== 'undefined') ? parts[1] + parts[2] : parts[2];
    };
    Path.prototype.base = function (current) {
        /** @type {?} */
        var __this = this;
        return reduce(this.parentsArray(current), function (acum, elem) {
            /** @type {?} */
            var elemUrl;
            /** @type {?} */
            var elemSelfLink = __this.config.getUrlFromElem(elem);
            if (elemSelfLink) {
                if (__this.config.isAbsoluteUrl(elemSelfLink)) {
                    return elemSelfLink;
                }
                else {
                    elemUrl = elemSelfLink;
                }
            }
            else {
                elemUrl = elem[__this.config.restangularFields.route];
                if (elem[__this.config.restangularFields.restangularCollection]) {
                    /** @type {?} */
                    var ids = elem[__this.config.restangularFields.ids];
                    if (ids) {
                        elemUrl += '/' + ids.join(',');
                    }
                }
                else {
                    /** @type {?} */
                    var elemId = void 0;
                    if (__this.config.useCannonicalId) {
                        elemId = __this.config.getCannonicalIdFromElem(elem);
                    }
                    else {
                        elemId = __this.config.getIdFromElem(elem);
                    }
                    if (configuration.isValidId(elemId) && !elem.singleOne) {
                        elemUrl += '/' + (__this.config.encodeIds ? encodeURIComponent(elemId) : elemId);
                    }
                }
            }
            acum = acum.replace(/\/$/, '') + '/' + elemUrl;
            return __this.normalizeUrl(acum);
        }, this.config.baseUrl);
    };
    Path.prototype.fetchUrl = function (current, what) {
        /** @type {?} */
        var baseUrl = this.base(current);
        if (what) {
            baseUrl += '/' + what;
        }
        return baseUrl;
    };
    Path.prototype.fetchRequestedUrl = function (current, what) {
        /** @type {?} */
        var url = this.fetchUrl(current, what);
        /** @type {?} */
        var params = current[configuration.restangularFields.reqParams];
        // From here on and until the end of fetchRequestedUrl,
        // the code has been kindly borrowed from angular.js
        // The reason for such code bloating is coherence:
        //   If the user were to use this for cache management, the
        //   serialization of parameters would need to be identical
        //   to the one done by angular for cache keys to match.
        /**
         * @param {?} obj
         * @return {?}
         */
        function sortedKeys(obj) {
            /** @type {?} */
            var resultKeys = [];
            for (var key in obj) {
                if (obj.hasOwnProperty(key)) {
                    resultKeys.push(key);
                }
            }
            return resultKeys.sort();
        }
        /**
         * @param {?} obj
         * @param {?=} iterator
         * @param {?=} context
         * @return {?}
         */
        function forEachSorted(obj, iterator, context) {
            /** @type {?} */
            var sortedKeysArray = sortedKeys(obj);
            for (var i = 0; i < sortedKeysArray.length; i++) {
                iterator.call(context, obj[sortedKeysArray[i]], sortedKeysArray[i]);
            }
            return sortedKeysArray;
        }
        /**
         * @param {?} val
         * @param {?=} pctEncodeSpaces
         * @return {?}
         */
        function encodeUriQuery(val, pctEncodeSpaces) {
            return encodeURIComponent(val)
                .replace(/%40/gi, '@')
                .replace(/%3A/gi, ':')
                .replace(/%24/g, '$')
                .replace(/%2C/gi, ',')
                .replace(/%20/g, (pctEncodeSpaces ? '%20' : '+'));
        }
        if (!params) {
            return url + (this.config.suffix || '');
        }
        /** @type {?} */
        var parts = [];
        forEachSorted(params, function (value, key) {
            if (value === null || value === undefined) {
                return;
            }
            if (!isArray(value)) {
                value = [value];
            }
            forEach(value, function (v) {
                if (isObject(v)) {
                    v = JSON.stringify(v);
                }
                parts.push(encodeUriQuery(key) + '=' + encodeUriQuery(v));
            });
        });
        return url + (this.config.suffix || '') + ((url.indexOf('?') === -1) ? '?' : '&') + parts.join('&');
    };
    configuration.urlCreatorFactory.path = Path;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LXJlc3Rhbmd1bGFyLWNvbmZpZy5mYWN0b3J5LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXJlc3Rhbmd1bGFyLyIsInNvdXJjZXMiOlsibGliL25neC1yZXN0YW5ndWxhci1jb25maWcuZmFjdG9yeS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFDTCxRQUFRLEVBQ1IsV0FBVyxFQUNYLE1BQU0sRUFDTixPQUFPLEVBQ1AsUUFBUSxFQUNSLFNBQVMsRUFDVCxRQUFRLEVBQ1IsSUFBSSxFQUNKLE1BQU0sRUFDTixJQUFJLEVBQ0osR0FBRyxFQUNILE9BQU8sRUFDUCxJQUFJLEVBQ0osS0FBSyxFQUNMLE1BQU0sRUFDTixJQUFJLEVBQ0osT0FBTyxFQUNQLE9BQU8sR0FDUixNQUFNLFFBQVEsQ0FBQzs7Ozs7O0FBRWhCLE1BQU0sVUFBVSxxQkFBcUIsQ0FBQyxNQUFNLEVBQUUsYUFBYTtJQUN6RCxNQUFNLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQzs7Ozs7UUFLL0IsV0FBVyxHQUFHLENBQUMsS0FBSyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLFNBQVMsQ0FBQztJQUNsRSxhQUFhLENBQUMsTUFBTSxHQUFHLFVBQVUsU0FBUztRQUN4QyxPQUFPLFFBQVEsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7SUFDeEQsQ0FBQyxDQUFDOztRQUVJLGVBQWUsR0FBRyxlQUFlO0lBQ3ZDLGFBQWEsQ0FBQyxhQUFhLEdBQUcsVUFBVSxNQUFNO1FBQzVDLE9BQU8sV0FBVyxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxNQUFNLENBQUMsYUFBYSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7WUFDbEYsTUFBTSxJQUFJLGVBQWUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQztZQUN4QyxhQUFhLENBQUMsV0FBVyxDQUFDO0lBQzlCLENBQUMsQ0FBQztJQUVG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QU8sQ0FBQyxLQUFLLEVBQUUsVUFBVSxDQUFDO2dCQUN4QixJQUFJLFFBQVEsQ0FBQyxDQUFDLENBQUMsRUFBRTtvQkFDZixDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDdkI7Z0JBQ0QsS0FBSyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLGNBQWMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVELENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLEdBQUcsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLEdBQUcsS0FBSyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztJQUN0RyxDQUFDLENBQUM7SUFFRixhQUFhLENBQUMsaUJBQWlCLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQztBQUM5QyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgaW5jbHVkZXMsXG4gIGlzVW5kZWZpbmVkLFxuICBpc051bGwsXG4gIGlzQXJyYXksXG4gIGlzT2JqZWN0LFxuICBpc0Jvb2xlYW4sXG4gIGRlZmF1bHRzLFxuICBlYWNoLFxuICBleHRlbmQsXG4gIGZpbmQsXG4gIGhhcyxcbiAgaW5pdGlhbCxcbiAgbGFzdCxcbiAgY2xvbmUsXG4gIHJlZHVjZSxcbiAga2V5cyxcbiAgaXNFbXB0eSxcbiAgZm9yRWFjaCxcbn0gZnJvbSAnbG9kYXNoJztcblxuZXhwb3J0IGZ1bmN0aW9uIFJlc3Rhbmd1bGFyQ29uZmlndXJlcihvYmplY3QsIGNvbmZpZ3VyYXRpb24pIHtcbiAgb2JqZWN0LmNvbmZpZ3VyYXRpb24gPSBjb25maWd1cmF0aW9uO1xuXG4gIC8qKlxuICAgKiBUaG9zZSBhcmUgSFRUUCBzYWZlIG1ldGhvZHMgZm9yIHdoaWNoIHRoZXJlIGlzIG5vIG5lZWQgdG8gcGFzcyBhbnkgZGF0YSB3aXRoIHRoZSByZXF1ZXN0LlxuICAgKi9cbiAgY29uc3Qgc2FmZU1ldGhvZHMgPSBbJ2dldCcsICdoZWFkJywgJ29wdGlvbnMnLCAndHJhY2UnLCAnZ2V0bGlzdCddO1xuICBjb25maWd1cmF0aW9uLmlzU2FmZSA9IGZ1bmN0aW9uIChvcGVyYXRpb24pIHtcbiAgICByZXR1cm4gaW5jbHVkZXMoc2FmZU1ldGhvZHMsIG9wZXJhdGlvbi50b0xvd2VyQ2FzZSgpKTtcbiAgfTtcblxuICBjb25zdCBhYnNvbHV0ZVBhdHRlcm4gPSAvXmh0dHBzPzpcXC9cXC8vaTtcbiAgY29uZmlndXJhdGlvbi5pc0Fic29sdXRlVXJsID0gZnVuY3Rpb24gKHN0cmluZykge1xuICAgIHJldHVybiBpc1VuZGVmaW5lZChjb25maWd1cmF0aW9uLmFic29sdXRlVXJsKSB8fCBpc051bGwoY29uZmlndXJhdGlvbi5hYnNvbHV0ZVVybCkgP1xuICAgICAgc3RyaW5nICYmIGFic29sdXRlUGF0dGVybi50ZXN0KHN0cmluZykgOlxuICAgICAgY29uZmlndXJhdGlvbi5hYnNvbHV0ZVVybDtcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLmFic29sdXRlVXJsID0gaXNVbmRlZmluZWQoY29uZmlndXJhdGlvbi5hYnNvbHV0ZVVybCkgPyB0cnVlIDogY29uZmlndXJhdGlvbi5hYnNvbHV0ZVVybDtcbiAgb2JqZWN0LnNldFNlbGZMaW5rQWJzb2x1dGVVcmwgPSBmdW5jdGlvbiAodmFsdWUpIHtcbiAgICBjb25maWd1cmF0aW9uLmFic29sdXRlVXJsID0gdmFsdWU7XG4gIH07XG4gIC8qKlxuICAgKiBUaGlzIGlzIHRoZSBCYXNlVVJMIHRvIGJlIHVzZWQgd2l0aCBSZXN0YW5ndWxhclxuICAgKi9cbiAgY29uZmlndXJhdGlvbi5iYXNlVXJsID0gaXNVbmRlZmluZWQoY29uZmlndXJhdGlvbi5iYXNlVXJsKSA/ICcnIDogY29uZmlndXJhdGlvbi5iYXNlVXJsO1xuICBvYmplY3Quc2V0QmFzZVVybCA9IGZ1bmN0aW9uIChuZXdCYXNlVXJsKSB7XG4gICAgY29uZmlndXJhdGlvbi5iYXNlVXJsID0gL1xcLyQvLnRlc3QobmV3QmFzZVVybCkgP1xuICAgICAgbmV3QmFzZVVybC5zdWJzdHJpbmcoMCwgbmV3QmFzZVVybC5sZW5ndGggLSAxKSA6XG4gICAgICBuZXdCYXNlVXJsO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBleHRyYSBmaWVsZHMgdG8ga2VlcCBmcm9tIHRoZSBwYXJlbnRzXG4gICAqL1xuICBjb25maWd1cmF0aW9uLmV4dHJhRmllbGRzID0gY29uZmlndXJhdGlvbi5leHRyYUZpZWxkcyB8fCBbXTtcbiAgb2JqZWN0LnNldEV4dHJhRmllbGRzID0gZnVuY3Rpb24gKG5ld0V4dHJhRmllbGRzKSB7XG4gICAgY29uZmlndXJhdGlvbi5leHRyYUZpZWxkcyA9IG5ld0V4dHJhRmllbGRzO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTb21lIGRlZmF1bHQgJGh0dHAgcGFyYW1ldGVyIHRvIGJlIHVzZWQgaW4gRVZFUlkgY2FsbFxuICAgKiovXG4gIGNvbmZpZ3VyYXRpb24uZGVmYXVsdEh0dHBGaWVsZHMgPSBjb25maWd1cmF0aW9uLmRlZmF1bHRIdHRwRmllbGRzIHx8IHt9O1xuICBvYmplY3Quc2V0RGVmYXVsdEh0dHBGaWVsZHMgPSBmdW5jdGlvbiAodmFsdWVzKSB7XG4gICAgY29uZmlndXJhdGlvbi5kZWZhdWx0SHR0cEZpZWxkcyA9IHZhbHVlcztcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKipcbiAgICogQWx3YXlzIHJldHVybiBwbGFpbiBkYXRhLCBubyByZXN0YW5ndWxhcml6ZWQgb2JqZWN0XG4gICAqKi9cbiAgY29uZmlndXJhdGlvbi5wbGFpbkJ5RGVmYXVsdCA9IGNvbmZpZ3VyYXRpb24ucGxhaW5CeURlZmF1bHQgfHwgZmFsc2U7XG4gIG9iamVjdC5zZXRQbGFpbkJ5RGVmYXVsdCA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgIGNvbmZpZ3VyYXRpb24ucGxhaW5CeURlZmF1bHQgPSB2YWx1ZSA9PT0gdHJ1ZSA/IHRydWUgOiBmYWxzZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLndpdGhIdHRwVmFsdWVzID0gZnVuY3Rpb24gKGh0dHBMb2NhbENvbmZpZywgb2JqKSB7XG4gICAgcmV0dXJuIGRlZmF1bHRzKG9iaiwgaHR0cExvY2FsQ29uZmlnLCBjb25maWd1cmF0aW9uLmRlZmF1bHRIdHRwRmllbGRzKTtcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLmVuY29kZUlkcyA9IGlzVW5kZWZpbmVkKGNvbmZpZ3VyYXRpb24uZW5jb2RlSWRzKSA/IHRydWUgOiBjb25maWd1cmF0aW9uLmVuY29kZUlkcztcbiAgb2JqZWN0LnNldEVuY29kZUlkcyA9IGZ1bmN0aW9uIChlbmNvZGUpIHtcbiAgICBjb25maWd1cmF0aW9uLmVuY29kZUlkcyA9IGVuY29kZTtcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLmRlZmF1bHRSZXF1ZXN0UGFyYW1zID0gY29uZmlndXJhdGlvbi5kZWZhdWx0UmVxdWVzdFBhcmFtcyB8fCB7XG4gICAgZ2V0OiB7fSxcbiAgICBwb3N0OiB7fSxcbiAgICBwdXQ6IHt9LFxuICAgIHJlbW92ZToge30sXG4gICAgY29tbW9uOiB7fVxuICB9O1xuXG4gIG9iamVjdC5zZXREZWZhdWx0UmVxdWVzdFBhcmFtcyA9IGZ1bmN0aW9uIChwYXJhbTEsIHBhcmFtMikge1xuICAgIGxldCBtZXRob2RzID0gW107XG4gICAgY29uc3QgcGFyYW1zID0gcGFyYW0yIHx8IHBhcmFtMTtcbiAgICBpZiAoIWlzVW5kZWZpbmVkKHBhcmFtMikpIHtcbiAgICAgIGlmIChpc0FycmF5KHBhcmFtMSkpIHtcbiAgICAgICAgbWV0aG9kcyA9IHBhcmFtMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1ldGhvZHMucHVzaChwYXJhbTEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBtZXRob2RzLnB1c2goJ2NvbW1vbicpO1xuICAgIH1cblxuICAgIGVhY2gobWV0aG9kcywgZnVuY3Rpb24gKG1ldGhvZCkge1xuICAgICAgY29uZmlndXJhdGlvbi5kZWZhdWx0UmVxdWVzdFBhcmFtc1ttZXRob2RdID0gcGFyYW1zO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIG9iamVjdC5yZXF1ZXN0UGFyYW1zID0gY29uZmlndXJhdGlvbi5kZWZhdWx0UmVxdWVzdFBhcmFtcztcblxuICBjb25maWd1cmF0aW9uLmRlZmF1bHRIZWFkZXJzID0gY29uZmlndXJhdGlvbi5kZWZhdWx0SGVhZGVycyB8fCB7fTtcbiAgb2JqZWN0LnNldERlZmF1bHRIZWFkZXJzID0gZnVuY3Rpb24gKGhlYWRlcnMpIHtcbiAgICBjb25maWd1cmF0aW9uLmRlZmF1bHRIZWFkZXJzID0gaGVhZGVycztcbiAgICBvYmplY3QuZGVmYXVsdEhlYWRlcnMgPSBjb25maWd1cmF0aW9uLmRlZmF1bHRIZWFkZXJzO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIG9iamVjdC5kZWZhdWx0SGVhZGVycyA9IGNvbmZpZ3VyYXRpb24uZGVmYXVsdEhlYWRlcnM7XG5cblxuICAvKipcbiAgICogTWV0aG9kIG92ZXJyaWRlcnMgcmVzcG9uc2UgTWV0aG9kXG4gICAqKi9cbiAgY29uZmlndXJhdGlvbi5kZWZhdWx0UmVzcG9uc2VNZXRob2QgPSBjb25maWd1cmF0aW9uLmRlZmF1bHRSZXNwb25zZU1ldGhvZCB8fCAncHJvbWlzZSc7XG4gIG9iamVjdC5zZXREZWZhdWx0UmVzcG9uc2VNZXRob2QgPSBmdW5jdGlvbiAobWV0aG9kKSB7XG4gICAgY29uZmlndXJhdGlvbi5kZWZhdWx0UmVzcG9uc2VNZXRob2QgPSBtZXRob2Q7XG4gICAgb2JqZWN0LmRlZmF1bHRSZXNwb25zZU1ldGhvZCA9IGNvbmZpZ3VyYXRpb24uZGVmYXVsdFJlc3BvbnNlTWV0aG9kO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuICBvYmplY3QuZGVmYXVsdFJlc3BvbnNlTWV0aG9kID0gY29uZmlndXJhdGlvbi5kZWZhdWx0UmVzcG9uc2VNZXRob2Q7XG5cbiAgLyoqXG4gICAqIE1ldGhvZCBvdmVycmlkZXJzIHdpbGwgc2V0IHdoaWNoIG1ldGhvZHMgYXJlIHNlbnQgdmlhIFBPU1Qgd2l0aCBhbiBYLUhUVFAtTWV0aG9kLU92ZXJyaWRlXG4gICAqKi9cbiAgY29uZmlndXJhdGlvbi5tZXRob2RPdmVycmlkZXJzID0gY29uZmlndXJhdGlvbi5tZXRob2RPdmVycmlkZXJzIHx8IFtdO1xuICBvYmplY3Quc2V0TWV0aG9kT3ZlcnJpZGVycyA9IGZ1bmN0aW9uICh2YWx1ZXMpIHtcbiAgICBjb25zdCBvdmVycmlkZXJzID0gZXh0ZW5kKFtdLCB2YWx1ZXMpO1xuICAgIGlmIChjb25maWd1cmF0aW9uLmlzT3ZlcnJpZGVuTWV0aG9kKCdkZWxldGUnLCBvdmVycmlkZXJzKSkge1xuICAgICAgb3ZlcnJpZGVycy5wdXNoKCdyZW1vdmUnKTtcbiAgICB9XG4gICAgY29uZmlndXJhdGlvbi5tZXRob2RPdmVycmlkZXJzID0gb3ZlcnJpZGVycztcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLmpzb25wID0gaXNVbmRlZmluZWQoY29uZmlndXJhdGlvbi5qc29ucCkgPyBmYWxzZSA6IGNvbmZpZ3VyYXRpb24uanNvbnA7XG4gIG9iamVjdC5zZXRKc29ucCA9IGZ1bmN0aW9uIChhY3RpdmUpIHtcbiAgICBjb25maWd1cmF0aW9uLmpzb25wID0gYWN0aXZlO1xuICB9O1xuXG4gIGNvbmZpZ3VyYXRpb24uaXNPdmVycmlkZW5NZXRob2QgPSBmdW5jdGlvbiAobWV0aG9kLCB2YWx1ZXMpIHtcbiAgICBjb25zdCBzZWFyY2ggPSB2YWx1ZXMgfHwgY29uZmlndXJhdGlvbi5tZXRob2RPdmVycmlkZXJzO1xuICAgIHJldHVybiAhaXNVbmRlZmluZWQoZmluZChzZWFyY2gsIGZ1bmN0aW9uIChvbmU6IHN0cmluZykge1xuICAgICAgcmV0dXJuIG9uZS50b0xvd2VyQ2FzZSgpID09PSBtZXRob2QudG9Mb3dlckNhc2UoKTtcbiAgICB9KSk7XG4gIH07XG5cbiAgLyoqXG4gICAqIFNldHMgdGhlIFVSTCBjcmVhdG9yIHR5cGUuIEZvciBub3csIG9ubHkgUGF0aCBpcyBjcmVhdGVkLiBJbiB0aGUgZnV0dXJlIHdlJ2xsIGhhdmUgcXVlcnlQYXJhbXNcbiAgICoqL1xuICBjb25maWd1cmF0aW9uLnVybENyZWF0b3IgPSBjb25maWd1cmF0aW9uLnVybENyZWF0b3IgfHwgJ3BhdGgnO1xuICBvYmplY3Quc2V0VXJsQ3JlYXRvciA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgaWYgKCFoYXMoY29uZmlndXJhdGlvbi51cmxDcmVhdG9yRmFjdG9yeSwgbmFtZSkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignVVJMIFBhdGggc2VsZWN0ZWQgaXNuXFwndCB2YWxpZCcpO1xuICAgIH1cblxuICAgIGNvbmZpZ3VyYXRpb24udXJsQ3JlYXRvciA9IG5hbWU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIFlvdSBjYW4gc2V0IHRoZSByZXN0YW5ndWxhciBmaWVsZHMgaGVyZS4gVGhlIDMgcmVxdWlyZWQgZmllbGRzIGZvciBSZXN0YW5ndWxhciBhcmU6XG4gICAqXG4gICAqIGlkOiBJZCBvZiB0aGUgZWxlbWVudFxuICAgKiByb3V0ZTogbmFtZSBvZiB0aGUgcm91dGUgb2YgdGhpcyBlbGVtZW50XG4gICAqIHBhcmVudFJlc291cmNlOiB0aGUgcmVmZXJlbmNlIHRvIHRoZSBwYXJlbnQgcmVzb3VyY2VcbiAgICpcbiAgICogIEFsbCBvZiB0aGlzIGZpZWxkcyBleGNlcHQgZm9yIGlkLCBhcmUgaGFuZGxlZCAoYW5kIGNyZWF0ZWQpIGJ5IFJlc3Rhbmd1bGFyLiBCeSBkZWZhdWx0LFxuICAgKiAgdGhlIGZpZWxkIHZhbHVlcyB3aWxsIGJlIGlkLCByb3V0ZSBhbmQgcGFyZW50UmVzb3VyY2UgcmVzcGVjdGl2ZWx5XG4gICAqL1xuICBjb25maWd1cmF0aW9uLnJlc3Rhbmd1bGFyRmllbGRzID0gY29uZmlndXJhdGlvbi5yZXN0YW5ndWxhckZpZWxkcyB8fCB7XG4gICAgaWQ6ICdpZCcsXG4gICAgcm91dGU6ICdyb3V0ZScsXG4gICAgcGFyZW50UmVzb3VyY2U6ICdwYXJlbnRSZXNvdXJjZScsXG4gICAgcmVzdGFuZ3VsYXJDb2xsZWN0aW9uOiAncmVzdGFuZ3VsYXJDb2xsZWN0aW9uJyxcbiAgICBjYW5ub25pY2FsSWQ6ICdfX2Nhbm5vbmljYWxJZCcsXG4gICAgZXRhZzogJ3Jlc3Rhbmd1bGFyRXRhZycsXG4gICAgc2VsZkxpbms6ICdocmVmJyxcbiAgICBnZXQ6ICdnZXQnLFxuICAgIGdldExpc3Q6ICdnZXRMaXN0JyxcbiAgICBwdXQ6ICdwdXQnLFxuICAgIHBvc3Q6ICdwb3N0JyxcbiAgICByZW1vdmU6ICdyZW1vdmUnLFxuICAgIGhlYWQ6ICdoZWFkJyxcbiAgICB0cmFjZTogJ3RyYWNlJyxcbiAgICBvcHRpb25zOiAnb3B0aW9ucycsXG4gICAgcGF0Y2g6ICdwYXRjaCcsXG4gICAgZ2V0UmVzdGFuZ3VsYXJVcmw6ICdnZXRSZXN0YW5ndWxhclVybCcsXG4gICAgZ2V0UmVxdWVzdGVkVXJsOiAnZ2V0UmVxdWVzdGVkVXJsJyxcbiAgICBwdXRFbGVtZW50OiAncHV0RWxlbWVudCcsXG4gICAgYWRkUmVzdGFuZ3VsYXJNZXRob2Q6ICdhZGRSZXN0YW5ndWxhck1ldGhvZCcsXG4gICAgZ2V0UGFyZW50TGlzdDogJ2dldFBhcmVudExpc3QnLFxuICAgIGNsb25lOiAnY2xvbmUnLFxuICAgIGlkczogJ2lkcycsXG4gICAgaHR0cENvbmZpZzogJ18kaHR0cENvbmZpZycsXG4gICAgcmVxUGFyYW1zOiAncmVxUGFyYW1zJyxcbiAgICBvbmU6ICdvbmUnLFxuICAgIGFsbDogJ2FsbCcsXG4gICAgc2V2ZXJhbDogJ3NldmVyYWwnLFxuICAgIG9uZVVybDogJ29uZVVybCcsXG4gICAgYWxsVXJsOiAnYWxsVXJsJyxcbiAgICBjdXN0b21QVVQ6ICdjdXN0b21QVVQnLFxuICAgIGN1c3RvbVBBVENIOiAnY3VzdG9tUEFUQ0gnLFxuICAgIGN1c3RvbVBPU1Q6ICdjdXN0b21QT1NUJyxcbiAgICBjdXN0b21ERUxFVEU6ICdjdXN0b21ERUxFVEUnLFxuICAgIGN1c3RvbUdFVDogJ2N1c3RvbUdFVCcsXG4gICAgY3VzdG9tR0VUTElTVDogJ2N1c3RvbUdFVExJU1QnLFxuICAgIGN1c3RvbU9wZXJhdGlvbjogJ2N1c3RvbU9wZXJhdGlvbicsXG4gICAgZG9QVVQ6ICdkb1BVVCcsXG4gICAgZG9QQVRDSDogJ2RvUEFUQ0gnLFxuICAgIGRvUE9TVDogJ2RvUE9TVCcsXG4gICAgZG9ERUxFVEU6ICdkb0RFTEVURScsXG4gICAgZG9HRVQ6ICdkb0dFVCcsXG4gICAgZG9HRVRMSVNUOiAnZG9HRVRMSVNUJyxcbiAgICBmcm9tU2VydmVyOiAnZnJvbVNlcnZlcicsXG4gICAgd2l0aENvbmZpZzogJ3dpdGhDb25maWcnLFxuICAgIHdpdGhIdHRwQ29uZmlnOiAnd2l0aEh0dHBDb25maWcnLFxuICAgIHNpbmdsZU9uZTogJ3NpbmdsZU9uZScsXG4gICAgcGxhaW46ICdwbGFpbicsXG4gICAgc2F2ZTogJ3NhdmUnLFxuICAgIHJlc3Rhbmd1bGFyaXplZDogJ3Jlc3Rhbmd1bGFyaXplZCdcbiAgfTtcbiAgb2JqZWN0LnNldFJlc3Rhbmd1bGFyRmllbGRzID0gZnVuY3Rpb24gKHJlc0ZpZWxkcykge1xuICAgIGNvbmZpZ3VyYXRpb24ucmVzdGFuZ3VsYXJGaWVsZHMgPVxuICAgICAgZXh0ZW5kKHt9LCBjb25maWd1cmF0aW9uLnJlc3Rhbmd1bGFyRmllbGRzLCByZXNGaWVsZHMpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIGNvbmZpZ3VyYXRpb24uaXNSZXN0YW5ndWxhcml6ZWQgPSBmdW5jdGlvbiAob2JqKSB7XG4gICAgcmV0dXJuICEhb2JqW2NvbmZpZ3VyYXRpb24ucmVzdGFuZ3VsYXJGaWVsZHMucmVzdGFuZ3VsYXJpemVkXTtcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLnNldEZpZWxkVG9FbGVtID0gZnVuY3Rpb24gKGZpZWxkLCBlbGVtLCB2YWx1ZSkge1xuICAgIGNvbnN0IHByb3BlcnRpZXMgPSBmaWVsZC5zcGxpdCgnLicpO1xuICAgIGxldCBpZFZhbHVlID0gZWxlbTtcbiAgICBlYWNoKGluaXRpYWwocHJvcGVydGllcyksIGZ1bmN0aW9uIChwcm9wOiBhbnkpIHtcbiAgICAgIGlkVmFsdWVbcHJvcF0gPSB7fTtcbiAgICAgIGlkVmFsdWUgPSBpZFZhbHVlW3Byb3BdO1xuICAgIH0pO1xuICAgIGNvbnN0IGluZGV4OiBhbnkgPSBsYXN0KHByb3BlcnRpZXMpO1xuICAgIGlkVmFsdWVbaW5kZXhdID0gdmFsdWU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgY29uZmlndXJhdGlvbi5nZXRGaWVsZEZyb21FbGVtID0gZnVuY3Rpb24gKGZpZWxkLCBlbGVtKSB7XG4gICAgY29uc3QgcHJvcGVydGllcyA9IGZpZWxkLnNwbGl0KCcuJyk7XG4gICAgbGV0IGlkVmFsdWU6IGFueSA9IGVsZW07XG4gICAgZWFjaChwcm9wZXJ0aWVzLCBmdW5jdGlvbiAocHJvcCkge1xuICAgICAgaWYgKGlkVmFsdWUpIHtcbiAgICAgICAgaWRWYWx1ZSA9IGlkVmFsdWVbcHJvcF07XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGNsb25lKGlkVmFsdWUpO1xuICB9O1xuXG4gIGNvbmZpZ3VyYXRpb24uc2V0SWRUb0VsZW0gPSBmdW5jdGlvbiAoZWxlbSwgaWQgLyosIHJvdXRlICovKSB7XG4gICAgY29uZmlndXJhdGlvbi5zZXRGaWVsZFRvRWxlbShjb25maWd1cmF0aW9uLnJlc3Rhbmd1bGFyRmllbGRzLmlkLCBlbGVtLCBpZCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgY29uZmlndXJhdGlvbi5nZXRJZEZyb21FbGVtID0gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICByZXR1cm4gY29uZmlndXJhdGlvbi5nZXRGaWVsZEZyb21FbGVtKGNvbmZpZ3VyYXRpb24ucmVzdGFuZ3VsYXJGaWVsZHMuaWQsIGVsZW0pO1xuICB9O1xuXG4gIGNvbmZpZ3VyYXRpb24uaXNWYWxpZElkID0gZnVuY3Rpb24gKGVsZW1JZCkge1xuICAgIHJldHVybiAnJyAhPT0gZWxlbUlkICYmICFpc1VuZGVmaW5lZChlbGVtSWQpICYmICFpc051bGwoZWxlbUlkKTtcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLnNldFVybFRvRWxlbSA9IGZ1bmN0aW9uIChlbGVtLCB1cmwgLyosIHJvdXRlICovKSB7XG4gICAgY29uZmlndXJhdGlvbi5zZXRGaWVsZFRvRWxlbShjb25maWd1cmF0aW9uLnJlc3Rhbmd1bGFyRmllbGRzLnNlbGZMaW5rLCBlbGVtLCB1cmwpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIGNvbmZpZ3VyYXRpb24uZ2V0VXJsRnJvbUVsZW0gPSBmdW5jdGlvbiAoZWxlbSkge1xuICAgIHJldHVybiBjb25maWd1cmF0aW9uLmdldEZpZWxkRnJvbUVsZW0oY29uZmlndXJhdGlvbi5yZXN0YW5ndWxhckZpZWxkcy5zZWxmTGluaywgZWxlbSk7XG4gIH07XG5cbiAgY29uZmlndXJhdGlvbi51c2VDYW5ub25pY2FsSWQgPSBpc1VuZGVmaW5lZChjb25maWd1cmF0aW9uLnVzZUNhbm5vbmljYWxJZCkgPyBmYWxzZSA6IGNvbmZpZ3VyYXRpb24udXNlQ2Fubm9uaWNhbElkO1xuICBvYmplY3Quc2V0VXNlQ2Fubm9uaWNhbElkID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgY29uZmlndXJhdGlvbi51c2VDYW5ub25pY2FsSWQgPSB2YWx1ZTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLmdldENhbm5vbmljYWxJZEZyb21FbGVtID0gZnVuY3Rpb24gKGVsZW0pIHtcbiAgICBjb25zdCBjYW5ub25pY2FsSWQgPSBlbGVtW2NvbmZpZ3VyYXRpb24ucmVzdGFuZ3VsYXJGaWVsZHMuY2Fubm9uaWNhbElkXTtcbiAgICBjb25zdCBhY3R1YWxJZCA9IGNvbmZpZ3VyYXRpb24uaXNWYWxpZElkKGNhbm5vbmljYWxJZCkgPyBjYW5ub25pY2FsSWQgOiBjb25maWd1cmF0aW9uLmdldElkRnJvbUVsZW0oZWxlbSk7XG4gICAgcmV0dXJuIGFjdHVhbElkO1xuICB9O1xuXG4gIC8qKlxuICAgKiBTZXRzIHRoZSBSZXNwb25zZSBwYXJzZXIuIFRoaXMgaXMgdXNlZCBpbiBjYXNlIHlvdXIgcmVzcG9uc2UgaXNuJ3QgZGlyZWN0bHkgdGhlIGRhdGEuXG4gICAqIEZvciBleGFtcGxlIGlmIHlvdSBoYXZlIGEgcmVzcG9uc2UgbGlrZSB7bWV0YTogeydtZXRhJ30sIGRhdGE6IHtuYW1lOiAnR29udG8nfX1cbiAgICogeW91IGNhbiBleHRyYWN0IHRoaXMgZGF0YSB3aGljaCBpcyB0aGUgb25lIHRoYXQgbmVlZHMgd3JhcHBpbmdcbiAgICpcbiAgICogVGhlIFJlc3BvbnNlRXh0cmFjdG9yIGlzIGEgZnVuY3Rpb24gdGhhdCByZWNlaXZlcyB0aGUgcmVzcG9uc2UgYW5kIHRoZSBtZXRob2QgZXhlY3V0ZWQuXG4gICAqL1xuXG4gIGNvbmZpZ3VyYXRpb24ucmVzcG9uc2VJbnRlcmNlcHRvcnMgPSBjb25maWd1cmF0aW9uLnJlc3BvbnNlSW50ZXJjZXB0b3JzID8gWy4uLmNvbmZpZ3VyYXRpb24ucmVzcG9uc2VJbnRlcmNlcHRvcnNdIDogW107XG5cbiAgY29uZmlndXJhdGlvbi5kZWZhdWx0UmVzcG9uc2VJbnRlcmNlcHRvciA9IGZ1bmN0aW9uIChkYXRhIC8qLCBvcGVyYXRpb24sIHdoYXQsIHVybCwgcmVzcG9uc2UsIHN1YmplY3QgKi8pIHtcbiAgICByZXR1cm4gZGF0YSB8fCB7fTtcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLnJlc3BvbnNlRXh0cmFjdG9yID0gZnVuY3Rpb24gKGRhdGEsIG9wZXJhdGlvbiwgd2hhdCwgdXJsLCByZXNwb25zZSwgc3ViamVjdCkge1xuICAgIGNvbnN0IGludGVyY2VwdG9ycyA9IGNsb25lKGNvbmZpZ3VyYXRpb24ucmVzcG9uc2VJbnRlcmNlcHRvcnMpO1xuICAgIGludGVyY2VwdG9ycy5wdXNoKGNvbmZpZ3VyYXRpb24uZGVmYXVsdFJlc3BvbnNlSW50ZXJjZXB0b3IpO1xuICAgIGxldCB0aGVEYXRhID0gZGF0YTtcbiAgICBlYWNoKGludGVyY2VwdG9ycywgZnVuY3Rpb24gKGludGVyY2VwdG9yOiBhbnkpIHtcbiAgICAgIHRoZURhdGEgPSBpbnRlcmNlcHRvcih0aGVEYXRhLCBvcGVyYXRpb24sXG4gICAgICAgIHdoYXQsIHVybCwgcmVzcG9uc2UsIHN1YmplY3QpO1xuICAgIH0pO1xuICAgIHJldHVybiB0aGVEYXRhO1xuICB9O1xuXG4gIG9iamVjdC5hZGRSZXNwb25zZUludGVyY2VwdG9yID0gZnVuY3Rpb24gKGV4dHJhY3Rvcikge1xuICAgIGNvbmZpZ3VyYXRpb24ucmVzcG9uc2VJbnRlcmNlcHRvcnMucHVzaChleHRyYWN0b3IpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIGNvbmZpZ3VyYXRpb24uZXJyb3JJbnRlcmNlcHRvcnMgPSBjb25maWd1cmF0aW9uLmVycm9ySW50ZXJjZXB0b3JzID8gWy4uLmNvbmZpZ3VyYXRpb24uZXJyb3JJbnRlcmNlcHRvcnNdIDogW107XG4gIG9iamVjdC5hZGRFcnJvckludGVyY2VwdG9yID0gZnVuY3Rpb24gKGludGVyY2VwdG9yKSB7XG4gICAgY29uZmlndXJhdGlvbi5lcnJvckludGVyY2VwdG9ycyA9IFtpbnRlcmNlcHRvciwgLi4uY29uZmlndXJhdGlvbi5lcnJvckludGVyY2VwdG9yc107XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgb2JqZWN0LnNldFJlc3BvbnNlSW50ZXJjZXB0b3IgPSBvYmplY3QuYWRkUmVzcG9uc2VJbnRlcmNlcHRvcjtcbiAgb2JqZWN0LnNldFJlc3BvbnNlRXh0cmFjdG9yID0gb2JqZWN0LmFkZFJlc3BvbnNlSW50ZXJjZXB0b3I7XG4gIG9iamVjdC5zZXRFcnJvckludGVyY2VwdG9yID0gb2JqZWN0LmFkZEVycm9ySW50ZXJjZXB0b3I7XG5cbiAgLyoqXG4gICAqIFJlc3BvbnNlIGludGVyY2VwdG9yIGlzIGNhbGxlZCBqdXN0IGJlZm9yZSByZXNvbHZpbmcgcHJvbWlzZXMuXG4gICAqL1xuXG5cbiAgLyoqXG4gICAqIFJlcXVlc3QgaW50ZXJjZXB0b3IgaXMgY2FsbGVkIGJlZm9yZSBzZW5kaW5nIGFuIG9iamVjdCB0byB0aGUgc2VydmVyLlxuICAgKi9cbiAgY29uZmlndXJhdGlvbi5yZXF1ZXN0SW50ZXJjZXB0b3JzID0gY29uZmlndXJhdGlvbi5yZXF1ZXN0SW50ZXJjZXB0b3JzID8gWy4uLmNvbmZpZ3VyYXRpb24ucmVxdWVzdEludGVyY2VwdG9yc10gOiBbXTtcblxuICBjb25maWd1cmF0aW9uLmRlZmF1bHRJbnRlcmNlcHRvciA9IGZ1bmN0aW9uIChlbGVtZW50LCBvcGVyYXRpb24sIHBhdGgsIHVybCwgaGVhZGVycywgcGFyYW1zLCBodHRwQ29uZmlnKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGVsZW1lbnQ6IGVsZW1lbnQsXG4gICAgICBoZWFkZXJzOiBoZWFkZXJzLFxuICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICBodHRwQ29uZmlnOiBodHRwQ29uZmlnXG4gICAgfTtcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLmZ1bGxSZXF1ZXN0SW50ZXJjZXB0b3IgPSBmdW5jdGlvbiAoZWxlbWVudCwgb3BlcmF0aW9uLCBwYXRoLCB1cmwsIGhlYWRlcnMsIHBhcmFtcywgaHR0cENvbmZpZykge1xuICAgIGNvbnN0IGludGVyY2VwdG9ycyA9IGNsb25lKGNvbmZpZ3VyYXRpb24ucmVxdWVzdEludGVyY2VwdG9ycyk7XG4gICAgY29uc3QgZGVmYXVsdFJlcXVlc3QgPSBjb25maWd1cmF0aW9uLmRlZmF1bHRJbnRlcmNlcHRvcihlbGVtZW50LCBvcGVyYXRpb24sIHBhdGgsIHVybCwgaGVhZGVycywgcGFyYW1zLCBodHRwQ29uZmlnKTtcbiAgICByZXR1cm4gcmVkdWNlKGludGVyY2VwdG9ycywgZnVuY3Rpb24gKHJlcXVlc3Q6IGFueSwgaW50ZXJjZXB0b3I6IGFueSkge1xuXG4gICAgICBjb25zdCByZXR1cm5JbnRlcmNlcHRvcjogYW55ID0gaW50ZXJjZXB0b3IoXG4gICAgICAgIHJlcXVlc3QuZWxlbWVudCxcbiAgICAgICAgb3BlcmF0aW9uLFxuICAgICAgICBwYXRoLFxuICAgICAgICB1cmwsXG4gICAgICAgIHJlcXVlc3QuaGVhZGVycyxcbiAgICAgICAgcmVxdWVzdC5wYXJhbXMsXG4gICAgICAgIHJlcXVlc3QuaHR0cENvbmZpZ1xuICAgICAgKTtcbiAgICAgIHJldHVybiBleHRlbmQocmVxdWVzdCwgcmV0dXJuSW50ZXJjZXB0b3IpO1xuICAgIH0sIGRlZmF1bHRSZXF1ZXN0KTtcbiAgfTtcblxuICBvYmplY3QuYWRkUmVxdWVzdEludGVyY2VwdG9yID0gZnVuY3Rpb24gKGludGVyY2VwdG9yKSB7XG4gICAgY29uZmlndXJhdGlvbi5yZXF1ZXN0SW50ZXJjZXB0b3JzLnB1c2goZnVuY3Rpb24gKGVsZW0sIG9wZXJhdGlvbiwgcGF0aCwgdXJsLCBoZWFkZXJzLCBwYXJhbXMsIGh0dHBDb25maWcpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGhlYWRlcnM6IGhlYWRlcnMsXG4gICAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgICAgICBlbGVtZW50OiBpbnRlcmNlcHRvcihlbGVtLCBvcGVyYXRpb24sIHBhdGgsIHVybCksXG4gICAgICAgIGh0dHBDb25maWc6IGh0dHBDb25maWdcbiAgICAgIH07XG4gICAgfSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgb2JqZWN0LnNldFJlcXVlc3RJbnRlcmNlcHRvciA9IG9iamVjdC5hZGRSZXF1ZXN0SW50ZXJjZXB0b3I7XG5cbiAgb2JqZWN0LmFkZEZ1bGxSZXF1ZXN0SW50ZXJjZXB0b3IgPSBmdW5jdGlvbiAoaW50ZXJjZXB0b3IpIHtcbiAgICBjb25maWd1cmF0aW9uLnJlcXVlc3RJbnRlcmNlcHRvcnMucHVzaChpbnRlcmNlcHRvcik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgb2JqZWN0LnNldEZ1bGxSZXF1ZXN0SW50ZXJjZXB0b3IgPSBvYmplY3QuYWRkRnVsbFJlcXVlc3RJbnRlcmNlcHRvcjtcblxuICBjb25maWd1cmF0aW9uLm9uQmVmb3JlRWxlbVJlc3Rhbmd1bGFyaXplZCA9IGNvbmZpZ3VyYXRpb24ub25CZWZvcmVFbGVtUmVzdGFuZ3VsYXJpemVkIHx8IGZ1bmN0aW9uIChlbGVtKSB7XG4gICAgcmV0dXJuIGVsZW07XG4gIH07XG4gIG9iamVjdC5zZXRPbkJlZm9yZUVsZW1SZXN0YW5ndWxhcml6ZWQgPSBmdW5jdGlvbiAocG9zdCkge1xuICAgIGNvbmZpZ3VyYXRpb24ub25CZWZvcmVFbGVtUmVzdGFuZ3VsYXJpemVkID0gcG9zdDtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBvYmplY3Quc2V0UmVzdGFuZ3VsYXJpemVQcm9taXNlSW50ZXJjZXB0b3IgPSBmdW5jdGlvbiAoaW50ZXJjZXB0b3IpIHtcbiAgICBjb25maWd1cmF0aW9uLnJlc3Rhbmd1bGFyaXplUHJvbWlzZUludGVyY2VwdG9yID0gaW50ZXJjZXB0b3I7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBhZnRlciBhbiBlbGVtZW50IGhhcyBiZWVuIFwiUmVzdGFuZ3VsYXJpemVkXCIuXG4gICAqXG4gICAqIEl0IHJlY2VpdmVzIHRoZSBlbGVtZW50LCBhIGJvb2xlYW4gaW5kaWNhdGluZyBpZiBpdCdzIGFuIGVsZW1lbnQgb3IgYSBjb2xsZWN0aW9uXG4gICAqIGFuZCB0aGUgbmFtZSBvZiB0aGUgbW9kZWxcbiAgICpcbiAgICovXG4gIGNvbmZpZ3VyYXRpb24ub25FbGVtUmVzdGFuZ3VsYXJpemVkID0gY29uZmlndXJhdGlvbi5vbkVsZW1SZXN0YW5ndWxhcml6ZWQgfHwgZnVuY3Rpb24gKGVsZW0pIHtcbiAgICByZXR1cm4gZWxlbTtcbiAgfTtcbiAgb2JqZWN0LnNldE9uRWxlbVJlc3Rhbmd1bGFyaXplZCA9IGZ1bmN0aW9uIChwb3N0KSB7XG4gICAgY29uZmlndXJhdGlvbi5vbkVsZW1SZXN0YW5ndWxhcml6ZWQgPSBwb3N0O1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIGNvbmZpZ3VyYXRpb24uc2hvdWxkU2F2ZVBhcmVudCA9IGNvbmZpZ3VyYXRpb24uc2hvdWxkU2F2ZVBhcmVudCB8fCBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH07XG4gIG9iamVjdC5zZXRQYXJlbnRsZXNzID0gZnVuY3Rpb24gKHZhbHVlcykge1xuICAgIGlmIChpc0FycmF5KHZhbHVlcykpIHtcbiAgICAgIGNvbmZpZ3VyYXRpb24uc2hvdWxkU2F2ZVBhcmVudCA9IGZ1bmN0aW9uIChyb3V0ZSkge1xuICAgICAgICByZXR1cm4gIWluY2x1ZGVzKHZhbHVlcywgcm91dGUpO1xuICAgICAgfTtcbiAgICB9IGVsc2UgaWYgKGlzQm9vbGVhbih2YWx1ZXMpKSB7XG4gICAgICBjb25maWd1cmF0aW9uLnNob3VsZFNhdmVQYXJlbnQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiAhdmFsdWVzO1xuICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIFRoaXMgbGV0cyB5b3Ugc2V0IGEgc3VmZml4IHRvIGV2ZXJ5IHJlcXVlc3QuXG4gICAqXG4gICAqIEZvciBleGFtcGxlLCBpZiB5b3VyIGFwaSByZXF1aXJlcyB0aGF0IGZvciBKU29uIHJlcXVlc3RzIHlvdSBkbyAvdXNlcnMvMTIzLmpzb24sIHlvdSBjYW4gc2V0IHRoYXRcbiAgICogaW4gaGVyZS5cbiAgICpcbiAgICpcbiAgICogQnkgZGVmYXVsdCwgdGhlIHN1ZmZpeCBpcyBudWxsXG4gICAqL1xuICBjb25maWd1cmF0aW9uLnN1ZmZpeCA9IGlzVW5kZWZpbmVkKGNvbmZpZ3VyYXRpb24uc3VmZml4KSA/IG51bGwgOiBjb25maWd1cmF0aW9uLnN1ZmZpeDtcbiAgb2JqZWN0LnNldFJlcXVlc3RTdWZmaXggPSBmdW5jdGlvbiAobmV3U3VmZml4KSB7XG4gICAgY29uZmlndXJhdGlvbi5zdWZmaXggPSBuZXdTdWZmaXg7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEFkZCBlbGVtZW50IHRyYW5zZm9ybWVycyBmb3IgY2VydGFpbiByb3V0ZXMuXG4gICAqL1xuICBjb25maWd1cmF0aW9uLnRyYW5zZm9ybWVycyA9IGNvbmZpZ3VyYXRpb24udHJhbnNmb3JtZXJzIHx8IHt9O1xuICBvYmplY3QuYWRkRWxlbWVudFRyYW5zZm9ybWVyID0gZnVuY3Rpb24gKHR5cGUsIHNlY29uZEFyZywgdGhpcmRBcmcpIHtcbiAgICBsZXQgaXNDb2xsZWN0aW9uID0gbnVsbDtcbiAgICBsZXQgdHJhbnNmb3JtZXIgPSBudWxsO1xuICAgIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XG4gICAgICB0cmFuc2Zvcm1lciA9IHNlY29uZEFyZztcbiAgICB9IGVsc2Uge1xuICAgICAgdHJhbnNmb3JtZXIgPSB0aGlyZEFyZztcbiAgICAgIGlzQ29sbGVjdGlvbiA9IHNlY29uZEFyZztcbiAgICB9XG5cbiAgICBsZXQgdHlwZVRyYW5zZm9ybWVycyA9IGNvbmZpZ3VyYXRpb24udHJhbnNmb3JtZXJzW3R5cGVdO1xuICAgIGlmICghdHlwZVRyYW5zZm9ybWVycykge1xuICAgICAgdHlwZVRyYW5zZm9ybWVycyA9IGNvbmZpZ3VyYXRpb24udHJhbnNmb3JtZXJzW3R5cGVdID0gW107XG4gICAgfVxuXG4gICAgdHlwZVRyYW5zZm9ybWVycy5wdXNoKGZ1bmN0aW9uIChjb2xsLCBlbGVtKSB7XG4gICAgICBpZiAoaXNOdWxsKGlzQ29sbGVjdGlvbikgfHwgKGNvbGwgPT09IGlzQ29sbGVjdGlvbikpIHtcbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybWVyKGVsZW0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGVsZW07XG4gICAgfSk7XG5cbiAgICByZXR1cm4gb2JqZWN0O1xuICB9O1xuXG4gIG9iamVjdC5leHRlbmRDb2xsZWN0aW9uID0gZnVuY3Rpb24gKHJvdXRlLCBmbikge1xuICAgIHJldHVybiBvYmplY3QuYWRkRWxlbWVudFRyYW5zZm9ybWVyKHJvdXRlLCB0cnVlLCBmbik7XG4gIH07XG5cbiAgb2JqZWN0LmV4dGVuZE1vZGVsID0gZnVuY3Rpb24gKHJvdXRlLCBmbikge1xuICAgIHJldHVybiBvYmplY3QuYWRkRWxlbWVudFRyYW5zZm9ybWVyKHJvdXRlLCBmYWxzZSwgZm4pO1xuICB9O1xuXG4gIGNvbmZpZ3VyYXRpb24udHJhbnNmb3JtRWxlbSA9IGZ1bmN0aW9uIChlbGVtLCBpc0NvbGxlY3Rpb24sIHJvdXRlLCBSZXN0YW5ndWxhciwgZm9yY2UpIHtcbiAgICBpZiAoIWZvcmNlICYmICFjb25maWd1cmF0aW9uLnRyYW5zZm9ybUxvY2FsRWxlbWVudHMgJiYgIWVsZW1bY29uZmlndXJhdGlvbi5yZXN0YW5ndWxhckZpZWxkcy5mcm9tU2VydmVyXSkge1xuICAgICAgcmV0dXJuIGVsZW07XG4gICAgfVxuICAgIGNvbnN0IHR5cGVUcmFuc2Zvcm1lcnMgPSBjb25maWd1cmF0aW9uLnRyYW5zZm9ybWVyc1tyb3V0ZV07XG4gICAgbGV0IGNoYW5nZWRFbGVtID0gZWxlbTtcbiAgICBpZiAodHlwZVRyYW5zZm9ybWVycykge1xuICAgICAgZWFjaCh0eXBlVHJhbnNmb3JtZXJzLCBmdW5jdGlvbiAodHJhbnNmb3JtZXI6IChpc0NvbGxlY3Rpb246IGJvb2xlYW4sIGNoYW5nZWRFbGVtOiBhbnkpID0+IGFueSkge1xuICAgICAgICBjaGFuZ2VkRWxlbSA9IHRyYW5zZm9ybWVyKGlzQ29sbGVjdGlvbiwgY2hhbmdlZEVsZW0pO1xuICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBjb25maWd1cmF0aW9uLm9uRWxlbVJlc3Rhbmd1bGFyaXplZChjaGFuZ2VkRWxlbSwgaXNDb2xsZWN0aW9uLCByb3V0ZSwgUmVzdGFuZ3VsYXIpO1xuICB9O1xuXG4gIGNvbmZpZ3VyYXRpb24udHJhbnNmb3JtTG9jYWxFbGVtZW50cyA9IGlzVW5kZWZpbmVkKGNvbmZpZ3VyYXRpb24udHJhbnNmb3JtTG9jYWxFbGVtZW50cykgP1xuICAgIGZhbHNlIDpcbiAgICBjb25maWd1cmF0aW9uLnRyYW5zZm9ybUxvY2FsRWxlbWVudHM7XG5cbiAgb2JqZWN0LnNldFRyYW5zZm9ybU9ubHlTZXJ2ZXJFbGVtZW50cyA9IGZ1bmN0aW9uIChhY3RpdmUpIHtcbiAgICBjb25maWd1cmF0aW9uLnRyYW5zZm9ybUxvY2FsRWxlbWVudHMgPSAhYWN0aXZlO1xuICB9O1xuXG4gIGNvbmZpZ3VyYXRpb24uZnVsbFJlc3BvbnNlID0gaXNVbmRlZmluZWQoY29uZmlndXJhdGlvbi5mdWxsUmVzcG9uc2UpID8gZmFsc2UgOiBjb25maWd1cmF0aW9uLmZ1bGxSZXNwb25zZTtcbiAgb2JqZWN0LnNldEZ1bGxSZXNwb25zZSA9IGZ1bmN0aW9uIChmdWxsKSB7XG4gICAgY29uZmlndXJhdGlvbi5mdWxsUmVzcG9uc2UgPSBmdWxsO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG5cbiAgLy8gSW50ZXJuYWwgdmFsdWVzIGFuZCBmdW5jdGlvbnNcbiAgY29uZmlndXJhdGlvbi51cmxDcmVhdG9yRmFjdG9yeSA9IHt9O1xuXG4gIC8qKlxuICAgKiBCYXNlIFVSTCBDcmVhdG9yLiBCYXNlIHByb3RvdHlwZSBmb3IgZXZlcnl0aGluZyByZWxhdGVkIHRvIGl0XG4gICAqKi9cblxuICBjb25zdCBCYXNlQ3JlYXRvciA9IGZ1bmN0aW9uICgpIHtcbiAgfTtcblxuICBCYXNlQ3JlYXRvci5wcm90b3R5cGUuc2V0Q29uZmlnID0gZnVuY3Rpb24gKGNvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEJhc2VDcmVhdG9yLnByb3RvdHlwZS5wYXJlbnRzQXJyYXkgPSBmdW5jdGlvbiAoY3VycmVudCkge1xuICAgIGNvbnN0IHBhcmVudHMgPSBbXTtcbiAgICB3aGlsZSAoY3VycmVudCkge1xuICAgICAgcGFyZW50cy5wdXNoKGN1cnJlbnQpO1xuICAgICAgY3VycmVudCA9IGN1cnJlbnRbdGhpcy5jb25maWcucmVzdGFuZ3VsYXJGaWVsZHMucGFyZW50UmVzb3VyY2VdO1xuICAgIH1cbiAgICByZXR1cm4gcGFyZW50cy5yZXZlcnNlKCk7XG4gIH07XG5cbiAgZnVuY3Rpb24gUmVzdGFuZ3VsYXJSZXNvdXJjZShjb25maWcsICRodHRwLCB1cmwsIGNvbmZpZ3VyZXIpIHtcbiAgICBjb25zdCByZXNvdXJjZSA9IHt9O1xuICAgIGVhY2goa2V5cyhjb25maWd1cmVyKSwgZnVuY3Rpb24gKGtleSkge1xuICAgICAgY29uc3QgdmFsdWUgPSBjb25maWd1cmVyW2tleV07XG5cbiAgICAgIC8vIEFkZCBkZWZhdWx0IHBhcmFtZXRlcnNcbiAgICAgIHZhbHVlLnBhcmFtcyA9IGV4dGVuZCh7fSwgdmFsdWUucGFyYW1zLCBjb25maWcuZGVmYXVsdFJlcXVlc3RQYXJhbXNbdmFsdWUubWV0aG9kLnRvTG93ZXJDYXNlKCldKTtcbiAgICAgIC8vIFdlIGRvbid0IHdhbnQgdGhlID8gaWYgbm8gcGFyYW1zIGFyZSB0aGVyZVxuICAgICAgaWYgKGlzRW1wdHkodmFsdWUucGFyYW1zKSkge1xuICAgICAgICBkZWxldGUgdmFsdWUucGFyYW1zO1xuICAgICAgfVxuXG4gICAgICBpZiAoY29uZmlnLmlzU2FmZSh2YWx1ZS5tZXRob2QpKSB7XG5cbiAgICAgICAgcmVzb3VyY2Vba2V5XSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHRDb25maWcgPSBleHRlbmQodmFsdWUsIHtcbiAgICAgICAgICAgIHVybDogdXJsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgcmV0dXJuICRodHRwLmNyZWF0ZVJlcXVlc3QocmVzdWx0Q29uZmlnKTtcbiAgICAgICAgfTtcblxuICAgICAgfSBlbHNlIHtcblxuICAgICAgICByZXNvdXJjZVtrZXldID0gZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHRDb25maWcgPSBleHRlbmQodmFsdWUsIHtcbiAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgZGF0YTogZGF0YVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHJldHVybiAkaHR0cC5jcmVhdGVSZXF1ZXN0KHJlc3VsdENvbmZpZyk7XG4gICAgICAgIH07XG5cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiByZXNvdXJjZTtcbiAgfVxuXG4gIEJhc2VDcmVhdG9yLnByb3RvdHlwZS5yZXNvdXJjZSA9IGZ1bmN0aW9uIChjdXJyZW50LCAkaHR0cCwgbG9jYWxIdHRwQ29uZmlnLCBjYWxsSGVhZGVycywgY2FsbFBhcmFtcywgd2hhdCwgZXRhZywgb3BlcmF0aW9uKSB7XG4gICAgY29uc3QgcGFyYW1zID0gZGVmYXVsdHMoY2FsbFBhcmFtcyB8fCB7fSwgdGhpcy5jb25maWcuZGVmYXVsdFJlcXVlc3RQYXJhbXMuY29tbW9uKTtcbiAgICBjb25zdCBoZWFkZXJzID0gZGVmYXVsdHMoY2FsbEhlYWRlcnMgfHwge30sIHRoaXMuY29uZmlnLmRlZmF1bHRIZWFkZXJzKTtcblxuICAgIGlmIChldGFnKSB7XG4gICAgICBpZiAoIWNvbmZpZ3VyYXRpb24uaXNTYWZlKG9wZXJhdGlvbikpIHtcbiAgICAgICAgaGVhZGVyc1snSWYtTWF0Y2gnXSA9IGV0YWc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBoZWFkZXJzWydJZi1Ob25lLU1hdGNoJ10gPSBldGFnO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCB1cmwgPSB0aGlzLmJhc2UoY3VycmVudCk7XG5cbiAgICBpZiAod2hhdCkge1xuICAgICAgbGV0IGFkZCA9ICcnO1xuICAgICAgaWYgKCEvXFwvJC8udGVzdCh1cmwpKSB7XG4gICAgICAgIGFkZCArPSAnLyc7XG4gICAgICB9XG4gICAgICBhZGQgKz0gd2hhdDtcbiAgICAgIHVybCArPSBhZGQ7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuY29uZmlnLnN1ZmZpeCAmJlxuICAgICAgdXJsLmluZGV4T2YodGhpcy5jb25maWcuc3VmZml4LCB1cmwubGVuZ3RoIC0gdGhpcy5jb25maWcuc3VmZml4Lmxlbmd0aCkgPT09IC0xICYmICF0aGlzLmNvbmZpZy5nZXRVcmxGcm9tRWxlbShjdXJyZW50KSkge1xuICAgICAgdXJsICs9IHRoaXMuY29uZmlnLnN1ZmZpeDtcbiAgICB9XG5cbiAgICBjdXJyZW50W3RoaXMuY29uZmlnLnJlc3Rhbmd1bGFyRmllbGRzLmh0dHBDb25maWddID0gdW5kZWZpbmVkO1xuXG4gICAgcmV0dXJuIFJlc3Rhbmd1bGFyUmVzb3VyY2UodGhpcy5jb25maWcsICRodHRwLCB1cmwsIHtcbiAgICAgIGdldExpc3Q6IHRoaXMuY29uZmlnLndpdGhIdHRwVmFsdWVzKGxvY2FsSHR0cENvbmZpZyxcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXG4gICAgICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xuICAgICAgICB9KSxcblxuICAgICAgZ2V0OiB0aGlzLmNvbmZpZy53aXRoSHR0cFZhbHVlcyhsb2NhbEh0dHBDb25maWcsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgfSksXG5cbiAgICAgIGpzb25wOiB0aGlzLmNvbmZpZy53aXRoSHR0cFZhbHVlcyhsb2NhbEh0dHBDb25maWcsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6ICdqc29ucCcsXG4gICAgICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xuICAgICAgICB9KSxcblxuICAgICAgcHV0OiB0aGlzLmNvbmZpZy53aXRoSHR0cFZhbHVlcyhsb2NhbEh0dHBDb25maWcsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6ICdQVVQnLFxuICAgICAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgfSksXG5cbiAgICAgIHBvc3Q6IHRoaXMuY29uZmlnLndpdGhIdHRwVmFsdWVzKGxvY2FsSHR0cENvbmZpZyxcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgfSksXG5cbiAgICAgIHJlbW92ZTogdGhpcy5jb25maWcud2l0aEh0dHBWYWx1ZXMobG9jYWxIdHRwQ29uZmlnLFxuICAgICAgICB7XG4gICAgICAgICAgbWV0aG9kOiAnREVMRVRFJyxcbiAgICAgICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXG4gICAgICAgIH0pLFxuXG4gICAgICBoZWFkOiB0aGlzLmNvbmZpZy53aXRoSHR0cFZhbHVlcyhsb2NhbEh0dHBDb25maWcsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6ICdIRUFEJyxcbiAgICAgICAgICBwYXJhbXM6IHBhcmFtcyxcbiAgICAgICAgICBoZWFkZXJzOiBoZWFkZXJzXG4gICAgICAgIH0pLFxuXG4gICAgICB0cmFjZTogdGhpcy5jb25maWcud2l0aEh0dHBWYWx1ZXMobG9jYWxIdHRwQ29uZmlnLFxuICAgICAgICB7XG4gICAgICAgICAgbWV0aG9kOiAnVFJBQ0UnLFxuICAgICAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgfSksXG5cbiAgICAgIG9wdGlvbnM6IHRoaXMuY29uZmlnLndpdGhIdHRwVmFsdWVzKGxvY2FsSHR0cENvbmZpZyxcbiAgICAgICAge1xuICAgICAgICAgIG1ldGhvZDogJ09QVElPTlMnLFxuICAgICAgICAgIHBhcmFtczogcGFyYW1zLFxuICAgICAgICAgIGhlYWRlcnM6IGhlYWRlcnNcbiAgICAgICAgfSksXG5cbiAgICAgIHBhdGNoOiB0aGlzLmNvbmZpZy53aXRoSHR0cFZhbHVlcyhsb2NhbEh0dHBDb25maWcsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6ICdQQVRDSCcsXG4gICAgICAgICAgcGFyYW1zOiBwYXJhbXMsXG4gICAgICAgICAgaGVhZGVyczogaGVhZGVyc1xuICAgICAgICB9KVxuICAgIH0pO1xuICB9O1xuXG4gIC8qKlxuICAgKiBUaGlzIGlzIHRoZSBQYXRoIFVSTCBjcmVhdG9yLiBJdCB1c2VzIFBhdGggdG8gc2hvdyBIaWVyYXJjaHkgaW4gdGhlIFJlc3QgQVBJLlxuICAgKiBUaGlzIG1lYW5zIHRoYXQgaWYgeW91IGhhdmUgYW4gQWNjb3VudCB0aGF0IHRoZW4gaGFzIGEgc2V0IG9mIEJ1aWxkaW5ncywgYSBVUkwgdG8gYSBidWlsZGluZ1xuICAgKiB3b3VsZCBiZSAvYWNjb3VudHMvMTIzL2J1aWxkaW5ncy80NTZcbiAgICoqL1xuICBjb25zdCBQYXRoID0gZnVuY3Rpb24gKCkge1xuICB9O1xuXG4gIFBhdGgucHJvdG90eXBlID0gbmV3IEJhc2VDcmVhdG9yKCk7XG5cbiAgUGF0aC5wcm90b3R5cGUubm9ybWFsaXplVXJsID0gZnVuY3Rpb24gKHVybCkge1xuICAgIGNvbnN0IHBhcnRzID0gLygoPzpodHRwW3NdPzopP1xcL1xcLyk/KC4qKT8vLmV4ZWModXJsKTtcbiAgICBwYXJ0c1syXSA9IHBhcnRzWzJdLnJlcGxhY2UoL1tcXFxcXFwvXSsvZywgJy8nKTtcbiAgICByZXR1cm4gKHR5cGVvZiBwYXJ0c1sxXSAhPT0gJ3VuZGVmaW5lZCcpID8gcGFydHNbMV0gKyBwYXJ0c1syXSA6IHBhcnRzWzJdO1xuICB9O1xuXG4gIFBhdGgucHJvdG90eXBlLmJhc2UgPSBmdW5jdGlvbiAoY3VycmVudCkge1xuICAgIGNvbnN0IF9fdGhpcyA9IHRoaXM7XG4gICAgcmV0dXJuIHJlZHVjZSh0aGlzLnBhcmVudHNBcnJheShjdXJyZW50KSwgZnVuY3Rpb24gKGFjdW06IGFueSwgZWxlbTogYW55KSB7XG4gICAgICBsZXQgZWxlbVVybDtcbiAgICAgIGNvbnN0IGVsZW1TZWxmTGluayA9IF9fdGhpcy5jb25maWcuZ2V0VXJsRnJvbUVsZW0oZWxlbSk7XG4gICAgICBpZiAoZWxlbVNlbGZMaW5rKSB7XG4gICAgICAgIGlmIChfX3RoaXMuY29uZmlnLmlzQWJzb2x1dGVVcmwoZWxlbVNlbGZMaW5rKSkge1xuICAgICAgICAgIHJldHVybiBlbGVtU2VsZkxpbms7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZWxlbVVybCA9IGVsZW1TZWxmTGluaztcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWxlbVVybCA9IGVsZW1bX190aGlzLmNvbmZpZy5yZXN0YW5ndWxhckZpZWxkcy5yb3V0ZV07XG5cbiAgICAgICAgaWYgKGVsZW1bX190aGlzLmNvbmZpZy5yZXN0YW5ndWxhckZpZWxkcy5yZXN0YW5ndWxhckNvbGxlY3Rpb25dKSB7XG4gICAgICAgICAgY29uc3QgaWRzID0gZWxlbVtfX3RoaXMuY29uZmlnLnJlc3Rhbmd1bGFyRmllbGRzLmlkc107XG4gICAgICAgICAgaWYgKGlkcykge1xuICAgICAgICAgICAgZWxlbVVybCArPSAnLycgKyBpZHMuam9pbignLCcpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsZXQgZWxlbUlkOiBhbnk7XG4gICAgICAgICAgaWYgKF9fdGhpcy5jb25maWcudXNlQ2Fubm9uaWNhbElkKSB7XG4gICAgICAgICAgICBlbGVtSWQgPSBfX3RoaXMuY29uZmlnLmdldENhbm5vbmljYWxJZEZyb21FbGVtKGVsZW0pO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbGVtSWQgPSBfX3RoaXMuY29uZmlnLmdldElkRnJvbUVsZW0oZWxlbSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGNvbmZpZ3VyYXRpb24uaXNWYWxpZElkKGVsZW1JZCkgJiYgIWVsZW0uc2luZ2xlT25lKSB7XG4gICAgICAgICAgICBlbGVtVXJsICs9ICcvJyArIChfX3RoaXMuY29uZmlnLmVuY29kZUlkcyA/IGVuY29kZVVSSUNvbXBvbmVudChlbGVtSWQpIDogZWxlbUlkKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGFjdW0gPSBhY3VtLnJlcGxhY2UoL1xcLyQvLCAnJykgKyAnLycgKyBlbGVtVXJsO1xuICAgICAgcmV0dXJuIF9fdGhpcy5ub3JtYWxpemVVcmwoYWN1bSk7XG5cbiAgICB9LCB0aGlzLmNvbmZpZy5iYXNlVXJsKTtcbiAgfTtcblxuXG4gIFBhdGgucHJvdG90eXBlLmZldGNoVXJsID0gZnVuY3Rpb24gKGN1cnJlbnQsIHdoYXQpIHtcbiAgICBsZXQgYmFzZVVybCA9IHRoaXMuYmFzZShjdXJyZW50KTtcbiAgICBpZiAod2hhdCkge1xuICAgICAgYmFzZVVybCArPSAnLycgKyB3aGF0O1xuICAgIH1cbiAgICByZXR1cm4gYmFzZVVybDtcbiAgfTtcblxuICBQYXRoLnByb3RvdHlwZS5mZXRjaFJlcXVlc3RlZFVybCA9IGZ1bmN0aW9uIChjdXJyZW50LCB3aGF0KSB7XG4gICAgY29uc3QgdXJsID0gdGhpcy5mZXRjaFVybChjdXJyZW50LCB3aGF0KTtcbiAgICBjb25zdCBwYXJhbXMgPSBjdXJyZW50W2NvbmZpZ3VyYXRpb24ucmVzdGFuZ3VsYXJGaWVsZHMucmVxUGFyYW1zXTtcblxuICAgIC8vIEZyb20gaGVyZSBvbiBhbmQgdW50aWwgdGhlIGVuZCBvZiBmZXRjaFJlcXVlc3RlZFVybCxcbiAgICAvLyB0aGUgY29kZSBoYXMgYmVlbiBraW5kbHkgYm9ycm93ZWQgZnJvbSBhbmd1bGFyLmpzXG4gICAgLy8gVGhlIHJlYXNvbiBmb3Igc3VjaCBjb2RlIGJsb2F0aW5nIGlzIGNvaGVyZW5jZTpcbiAgICAvLyAgIElmIHRoZSB1c2VyIHdlcmUgdG8gdXNlIHRoaXMgZm9yIGNhY2hlIG1hbmFnZW1lbnQsIHRoZVxuICAgIC8vICAgc2VyaWFsaXphdGlvbiBvZiBwYXJhbWV0ZXJzIHdvdWxkIG5lZWQgdG8gYmUgaWRlbnRpY2FsXG4gICAgLy8gICB0byB0aGUgb25lIGRvbmUgYnkgYW5ndWxhciBmb3IgY2FjaGUga2V5cyB0byBtYXRjaC5cbiAgICBmdW5jdGlvbiBzb3J0ZWRLZXlzKG9iaikge1xuICAgICAgY29uc3QgcmVzdWx0S2V5cyA9IFtdO1xuICAgICAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgIHJlc3VsdEtleXMucHVzaChrZXkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gcmVzdWx0S2V5cy5zb3J0KCk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZm9yRWFjaFNvcnRlZChvYmosIGl0ZXJhdG9yPywgY29udGV4dD8pIHtcbiAgICAgIGNvbnN0IHNvcnRlZEtleXNBcnJheSA9IHNvcnRlZEtleXMob2JqKTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc29ydGVkS2V5c0FycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGl0ZXJhdG9yLmNhbGwoY29udGV4dCwgb2JqW3NvcnRlZEtleXNBcnJheVtpXV0sIHNvcnRlZEtleXNBcnJheVtpXSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gc29ydGVkS2V5c0FycmF5O1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGVuY29kZVVyaVF1ZXJ5KHZhbCwgcGN0RW5jb2RlU3BhY2VzPykge1xuICAgICAgcmV0dXJuIGVuY29kZVVSSUNvbXBvbmVudCh2YWwpXG4gICAgICAucmVwbGFjZSgvJTQwL2dpLCAnQCcpXG4gICAgICAucmVwbGFjZSgvJTNBL2dpLCAnOicpXG4gICAgICAucmVwbGFjZSgvJTI0L2csICckJylcbiAgICAgIC5yZXBsYWNlKC8lMkMvZ2ksICcsJylcbiAgICAgIC5yZXBsYWNlKC8lMjAvZywgKHBjdEVuY29kZVNwYWNlcyA/ICclMjAnIDogJysnKSk7XG4gICAgfVxuXG4gICAgaWYgKCFwYXJhbXMpIHtcbiAgICAgIHJldHVybiB1cmwgKyAodGhpcy5jb25maWcuc3VmZml4IHx8ICcnKTtcbiAgICB9XG5cbiAgICBjb25zdCBwYXJ0cyA9IFtdO1xuICAgIGZvckVhY2hTb3J0ZWQocGFyYW1zLCBmdW5jdGlvbiAodmFsdWUsIGtleSkge1xuICAgICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKCFpc0FycmF5KHZhbHVlKSkge1xuICAgICAgICB2YWx1ZSA9IFt2YWx1ZV07XG4gICAgICB9XG5cbiAgICAgIGZvckVhY2godmFsdWUsIGZ1bmN0aW9uICh2KSB7XG4gICAgICAgIGlmIChpc09iamVjdCh2KSkge1xuICAgICAgICAgIHYgPSBKU09OLnN0cmluZ2lmeSh2KTtcbiAgICAgICAgfVxuICAgICAgICBwYXJ0cy5wdXNoKGVuY29kZVVyaVF1ZXJ5KGtleSkgKyAnPScgKyBlbmNvZGVVcmlRdWVyeSh2KSk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIHJldHVybiB1cmwgKyAodGhpcy5jb25maWcuc3VmZml4IHx8ICcnKSArICgodXJsLmluZGV4T2YoJz8nKSA9PT0gLTEpID8gJz8nIDogJyYnKSArIHBhcnRzLmpvaW4oJyYnKTtcbiAgfTtcblxuICBjb25maWd1cmF0aW9uLnVybENyZWF0b3JGYWN0b3J5LnBhdGggPSBQYXRoO1xufVxuIl19